\documentclass[twocolumn]{article}

\usepackage{mathtools}
\usepackage[margin=1in]{geometry}

\date{\today}
\author{NASA QuAIL \and DLR}
\title{Quantum annealing for ATM:\@ a preliminary investigation into the delay-only model}

\newcommand{\func}[1]{f^{(\mathrm{#1})}}
\newcommand{\penweight}[1]{\lambda^{(\mathrm{#1})}}
\newcommand{\dmax}{d_{\max}}

\DeclareMathOperator*{\argmin}{arg\,min}

\begin{document}
\maketitle

\section{Introduction}

\section{Problem statement}

We are given a set of $n$ wind-optimal trajectories 
${\left(\mathbf{x}_i\right)}_{i=1}^n$, 
where 
$\mathbf{x}_i = {\left(x_{i,t}\right)}_{t=\tau_{i,0}}^{\tau_{i,1}}$ 
and 
$x_{i, t}$ is the location (as latitutude, longitude, and altitude) of the $i$th flight at time\footnote{For convenience, we work in units in which pairs of subsequent times are separated by a unit of time.} $t$.
The times $\tau_{i,0}$ and $\tau_{i, 1}$ are the times at which the wind-optimal trajectory for the $i$th flight begins and ends, respectively.
Let $T_i = \left(\tau_{i, 0}, \tau_{i, 0} + 1, \ldots, \tau_{i, 1}\right)$.
Each flight $i$ is at a constant speed $v_i$, to within (classical) machine precision.

The trajectory $\mathbf{x}'_i$ of the $i$th flight subject to delay $d_i$ is given by
$\mathbf{x}'_i = {\left(x'_{i,t}\right)}_{t=\tau'_{i,0}}^{\tau'_{i,1}}$,
where 
$\tau'_{i,0} = \tau_{i,0} + d_i$,
$\tau'_{i,1} = \tau_{i,1} + d_i$, and
${x'}_{i,t} = x_{i, t - d_i}$.
Let $T_i = [\tau_{i, 0}, \tau_{i, 1}]$.

The problem is to find the set of delays 
$\mathbf d = {\left(d_i\right)}_{i=1}^n$ such that $\sum_{i=1}^n d_i$ is minimized subject to the constrant that conflicts are avoided.
Let $\Delta_x$ and $\delta_t$ be respectively the spatial and temporal minimum separation standards. 

Two spacetime points $\mathbf x'_{i,t}$ and $\mathbf x'_{j,u}$ are in conflict if 
$\|\mathbf x'_{i,t} - \mathbf x'_{j,u}\| \leq \Delta_x$ and $|t - u| \leq \Delta_t$.

For flights $i$ and $j$, let 
$T_{i,j} = 
\left\{(t, u) \in T_i \times T_j \middle| \left\|x_{i,t} - x_{j,u}\right\| \leq \Delta_x \right\}$.
For every $(t, u) \in T_{i, j}$, we have the constraint $|(t + d_i) - (u + d_j)| > \Delta_t$, 
i.e.
%\begin{equation}
%\begin{split}
%\lefteqn{\left((t - u) + (d_i  - d_j) > \Delta_t\right)} \\
%& \lor
%\left(-\left[(t-u) + (d_i - d_j)\right] > \Delta_t\right), \\
%\Rightarrow&
%\left(d_i  - d_j > \Delta_t - (t -u)\right) \lor
%\left(d_i - d_j < -\Delta_t - (t-u)\right).
%\end{split}
%\end{equation}
%In other words, 
there is a conflict if 
\begin{equation}
- \Delta_t - (t - u) \leq d_i - d_j \leq \Delta_t - (t -u).
\end{equation}
Let 
$D_{i, j, t, u} = [- \Delta_t - (t -u), \Delta_t - (t -u)]$
and
$D_{i, j} = \bigcup_{(t, u) \in T_{i, j}} D_{i, j, t, u}$.
Assuming that the segments $\left\{D_{i, j, t, u} \middle| (t, u) \in T_{i, j}\right\}$ are contiguous, this simplifies to
$D_{i, j} = 
\left[b_{i, j, 0}, b_{i, j, 1}\right]$,
where
\begin{align}
b_{i, j, 0} &= -\Delta_t - \max_{(t, u) \in T_{i, j}} \{t -u\},\\
b_{i, j, 1} &= \Delta_t - \min_{(t, u) \in T_{i, j}} \{t -u\}.
\end{align}

In this notation, the conflict-avoidance constraint can be formulated as 
$d_i - d_j \notin D_{i, j}$ for all $i$, $j$.

%If $|t - u| > \dmax + \Delta_t$, then this is satisfied for all values of $d_i$, $d_j$:
%\begin{align}
%  \lefteqn{|(t + d_i) - (u + d_j)|}\\
%&=
%|(t - u) - (d_j - d_i)|
%\geq \left||t-u| - |d_j - d_i|\right| \\
%&\geq |t-u| - \dmax
%> \Delta_t.
%\end{align}

%% spacetime formulation of conflicts
%Let $v_{i,j} = (v_i + v_j) / 2$ be the mean velocity of flights $i$ and $j$
%and
%\begin{equation}
%s_{i,j,t,t'} = 
%\sqrt{
%{\left(x'_{i,t} - x'_{j,t'}\right)}^2 + 
%v_{i,j}^2 {\left(t - t'\right)}^2
%}
%\end{equation}
%is the spacetime separation between flight $i$ at time $t$ and flight $j$ at time $t'$.
%\begin{equation}
%s_{i, j, t} = 
%\argmin_{t'} s_{i, j, t', t' + t}
%\end{equation}
%
%\begin{equation}
%s_{i, j} = 
%\argmin_{t : s_{i, j, t}}
%\end{equation}

The delay will be discretized to resolution $\Delta_d$; that is, each $d_i \in \{0, \Delta_d, 2\Delta_d, \ldots, \dmax\}$.
When $\Delta_d = 0$, $d_i \in [0, \dmax]$.

An instance is specified by $n$, $\dmax$, $\Delta_d$, and ${\left(b_{i, j, k}\right)}_{\substack{\{i, j\} \in \binom{[n]}{2} \\ k \in \{0, 1\}}}$.

\section{Mapping to QUBO}

We encode the delay $d_i$ of flight $i$ using one-hot encoding.
That is, $d_i$ is represented by the bits 
${\left( d_{i,\alpha}\right)}_{\alpha=0}^{\dmax/\Delta_d}$, where $d_{i,\alpha} = 1$ for $\alpha = d_i / \Delta_d$ and is zero otherwise.
Thus $d_i = \sum_{\alpha=0}^{\dmax / \Delta_d} \Delta_d \alpha d_{i,\alpha}$.

To enforce this encoding, we use the penalty function
\begin{align}
\func{one-hot} 
&= \sum_{i = 1}^n \func{one-hot}_i,  \\
\func{one-hot}_i 
&= 
\penweight{one-hot}_i 
{\left(\sum_{\alpha = 0}^{\dmax / \Delta_d} d_{i, \alpha}\right)}^2.
\end{align}

The cost function to be minimized is 
\begin{equation}
\func{cost} = 
\Delta_d \sum_{i = 1}^n \sum_{\alpha = 0}^{\dmax / \Delta_d} \alpha d_{i, \alpha}.
\end{equation}

Conflicts are avoided using the penalty  function
\begin{equation}
\func{conflict} = 
\sum_{\{i, j\} \in \binom{[n]}{2}}
\penweight{conflict}_{i, j}
\sum_{\alpha, \beta \in [\dmax/\Delta_d]} d_{i,\alpha} d_{j, \beta}.
\end{equation}

Putting it together, we have
\begin{equation}
  f = \func{cost} + \func{one-hot} + \func{conflict}.
\end{equation}



\section{Instance generation}
Salvatore

\section{Delay precision and optimality gap}


\section{Penalty weights} 

% lambda
% lambda_conflict lambda_start
% lambda_conflict^i lambda_start^i
% lambda_conflict^{ij}
% lambda_conflict^{iajb}
\subsection{Exact}

\subsection{D-Wave}

\end{document}
